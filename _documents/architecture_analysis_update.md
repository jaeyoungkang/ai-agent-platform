# AI ì—ì´ì „íŠ¸ í”Œë«í¼ - ì•„í‚¤í…ì²˜ ë¶„ì„ ë° ì—…ë°ì´íŠ¸

**ì‘ì„±ì¼**: 2025ë…„ 8ì›” 19ì¼  
**ë¶„ì„ ëª©ì **: í˜„ì¬ ì»¨í…Œì´ë„ˆ ì‚¬ìš© íŒ¨í„´ ì ê²€ ë° ë‹¨ìˆœí™” ë°©í–¥ ì œì‹œ

---

## ğŸ“Š í˜„ì¬ ì•„í‚¤í…ì²˜ ë¶„ì„

### ğŸ³ ì»¨í…Œì´ë„ˆ ìƒì„± íŒ¨í„´ í˜„í™©

#### í˜„ì¬ êµ¬ì¡°
```python
# main.py:34-40
class UserWorkspace:
    def __init__(self, user_id: str):
        self.user_id = user_id
        self.container = None
        self.container_name = f"workspace-{user_id}"  # ì‚¬ìš©ìë‹¹ 1ê°œ ì»¨í…Œì´ë„ˆ
```

#### ì‹¤ì œ ë™ì‘ ë°©ì‹
1. **WebSocket ì—°ê²° ì‹œ**: ì‚¬ìš©ìë³„ ì»¨í…Œì´ë„ˆ 1ê°œ ìƒì„±/ì¬ì‚¬ìš©
2. **ì—ì´ì „íŠ¸ ìƒì„± ì‹œ**: **ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ ìƒì„± ì—†ìŒ** - ê¸°ì¡´ ì‚¬ìš©ì ì»¨í…Œì´ë„ˆ ì¬ì‚¬ìš©
3. **ì»¨í…Œì´ë„ˆ ë²”ìœ„**: ì‚¬ìš©ì ë‹¨ìœ„ (ì—ì´ì „íŠ¸ ë‹¨ìœ„ ì•„ë‹˜)

---

## ğŸ” ì»¨í…Œì´ë„ˆ ì‚¬ìš© íŒ¨í„´ ë¶„ì„

### âœ… í˜„ì¬ íŒ¨í„´: "1ì¸ 1ì»¨í…Œì´ë„ˆ"

```
ì‚¬ìš©ì A â†’ ì»¨í…Œì´ë„ˆ A â†’ ì—ì´ì „íŠ¸ 1, 2, 3, 4...
ì‚¬ìš©ì B â†’ ì»¨í…Œì´ë„ˆ B â†’ ì—ì´ì „íŠ¸ 5, 6, 7...
ì‚¬ìš©ì C â†’ ì»¨í…Œì´ë„ˆ C â†’ ì—ì´ì „íŠ¸ 8, 9...
```

**ì¥ì :**
- âœ… **ë‹¨ìˆœí•œ êµ¬ì¡°**: ì‚¬ìš©ìë‹¹ í•˜ë‚˜ì˜ í™˜ê²½
- âœ… **ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì **: ì—ì´ì „íŠ¸ë§ˆë‹¤ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ì§€ ì•ŠìŒ
- âœ… **ê´€ë¦¬ ìš©ì´**: ì‚¬ìš©ìë³„ ë°ì´í„° ê²©ë¦¬
- âœ… **ë¹ ë¥¸ ì—ì´ì „íŠ¸ ìƒì„±**: ì»¨í…Œì´ë„ˆ ì¬ì‚¬ìš©ìœ¼ë¡œ ì¦‰ì‹œ ì‹œì‘

**ë‹¨ì :**
- âš ï¸ **ì—ì´ì „íŠ¸ ê°„ ê²©ë¦¬ ë¶€ì¡±**: ê°™ì€ ì‚¬ìš©ìì˜ ì—ì´ì „íŠ¸ë“¤ì´ íŒŒì¼ì‹œìŠ¤í…œ ê³µìœ 
- âš ï¸ **ë¦¬ì†ŒìŠ¤ ì œí•œ ê³µìœ **: 1GB ë©”ëª¨ë¦¬ë¥¼ ëª¨ë“  ì—ì´ì „íŠ¸ê°€ ë‚˜ëˆ  ì‚¬ìš©

### âŒ ëŒ€ì•ˆ: "1ì—ì´ì „íŠ¸ 1ì»¨í…Œì´ë„ˆ" (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)

```
ì—ì´ì „íŠ¸ 1 â†’ ì»¨í…Œì´ë„ˆ 1
ì—ì´ì „íŠ¸ 2 â†’ ì»¨í…Œì´ë„ˆ 2  
ì—ì´ì „íŠ¸ 3 â†’ ì»¨í…Œì´ë„ˆ 3
...
```

**ë‹¨ì :**
- âŒ **ë¦¬ì†ŒìŠ¤ ë‚­ë¹„**: ì»¨í…Œì´ë„ˆë§ˆë‹¤ ê¸°ë³¸ 500MB+ ë©”ëª¨ë¦¬ ì‚¬ìš©
- âŒ **ì‹œì‘ ì‹œê°„ ì¦ê°€**: ì—ì´ì „íŠ¸ ìƒì„±ë§ˆë‹¤ 3-5ì´ˆ ëŒ€ê¸°
- âŒ **ë³µì¡ì„± ì¦ê°€**: ì»¨í…Œì´ë„ˆ ìƒëª…ì£¼ê¸° ê´€ë¦¬ ë³µì¡
- âŒ **ìš´ì˜ ë¶€ë‹´**: ìˆ˜ì‹­/ìˆ˜ë°± ê°œ ì»¨í…Œì´ë„ˆ ê´€ë¦¬

---

## ğŸ’¡ ê¶Œì¥ì‚¬í•­: í˜„ì¬ êµ¬ì¡° ìœ ì§€

### ğŸ¯ í•µì‹¬ ì›ì¹™: "ì ì€ ì½”ë“œ, ë‹¨ìˆœí•œ êµ¬ì¡°"

í˜„ì¬ì˜ **"1ì¸ 1ì»¨í…Œì´ë„ˆ"** ë°©ì‹ì´ ìš”êµ¬ì‚¬í•­ì— ìµœì í™”ë˜ì–´ ìˆìŒ:

1. **ë‹¨ìˆœì„±**: ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ë¡œì§ ìµœì†Œí™”
2. **íš¨ìœ¨ì„±**: ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì˜ˆì¸¡ ê°€ëŠ¥
3. **ì‘ë‹µì„±**: ì—ì´ì „íŠ¸ ì¦‰ì‹œ ìƒì„± ê°€ëŠ¥
4. **í™•ì¥ì„±**: ì‚¬ìš©ì ì¦ê°€ì— ì„ í˜•ì ìœ¼ë¡œ ëŒ€ì‘

### ğŸ“‹ êµ¬ì²´ì  ê°œì„  ë°©ì•ˆ

#### 1. ì—ì´ì „íŠ¸ë³„ ì‘ì—… ë””ë ‰í† ë¦¬ ë¶„ë¦¬
```python
# í˜„ì¬: /workspace (ê³µìœ )
# ê°œì„ : /workspace/agent-{agent_id}

def get_agent_workdir(self, agent_id: str) -> str:
    return f"/workspace/agent-{agent_id}"
```

#### 2. ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ ê°•í™”
```python
def check_container_resources(self):
    """ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì²´í¬"""
    stats = self.container.stats(stream=False)
    memory_usage = stats['memory_stats']['usage']
    if memory_usage > 800_000_000:  # 800MB ì´ˆê³¼ì‹œ
        logger.warning(f"High memory usage for user {self.user_id}")
```

#### 3. ì—ì´ì „íŠ¸ë³„ í™˜ê²½ ë³€ìˆ˜ ê²©ë¦¬
```python
def set_agent_env(self, agent_id: str, env_vars: dict):
    """ì—ì´ì „íŠ¸ë³„ í™˜ê²½ ì„¤ì •"""
    env_file_path = f"/workspace/agent-{agent_id}/.env"
    # ì—ì´ì „íŠ¸ë³„ .env íŒŒì¼ ìƒì„±
```

---

## ğŸ”§ ì½”ë“œ ë‹¨ìˆœí™” ê°€ì´ë“œë¼ì¸

### ğŸš« í”¼í•´ì•¼ í•  ë³µì¡ì„±

1. **ì»¨í…Œì´ë„ˆ í’€ë§**: ë¯¸ë¦¬ ìƒì„±ëœ ì»¨í…Œì´ë„ˆ ê´€ë¦¬
2. **ë™ì  ë¦¬ì†ŒìŠ¤ í• ë‹¹**: ì—ì´ì „íŠ¸ë³„ ë©”ëª¨ë¦¬/CPU ì¡°ì •
3. **ë³µì¡í•œ ìŠ¤ì¼€ì¤„ë§**: ì—ì´ì „íŠ¸ ì‹¤í–‰ í ê´€ë¦¬
4. **ê³ ê¸‰ ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘

### âœ… ìœ ì§€í•´ì•¼ í•  ë‹¨ìˆœì„±

1. **ì‚¬ìš©ì ì—°ê²°ì‹œ ì»¨í…Œì´ë„ˆ ìƒì„±/ì¬ì‚¬ìš©**
2. **ì—ì´ì „íŠ¸ ìƒì„±ì‹œ ë””ë ‰í† ë¦¬ë§Œ ë¶„ë¦¬**
3. **WebSocket ì—°ê²° ì¢…ë£Œì‹œ ì»¨í…Œì´ë„ˆ ì •ë¦¬**
4. **ê¸°ë³¸ì ì¸ ë¡œê¹…ê³¼ ì˜¤ë¥˜ ì²˜ë¦¬**

---

## ğŸ“Š ë¦¬ì†ŒìŠ¤ ì˜ˆì¸¡ ë° ì œí•œ

### í˜„ì¬ ì„¤ì • (main.py:83-84)
```python
mem_limit="1g",      # ì‚¬ìš©ìë‹¹ 1GB ë©”ëª¨ë¦¬
cpu_count=1,         # ì‚¬ìš©ìë‹¹ 1 CPU ì½”ì–´
```

### ì‚¬ìš©ìë³„ ì—ì´ì „íŠ¸ ìˆ˜ ì œí•œ
```
ê¶Œì¥: ì‚¬ìš©ìë‹¹ ìµœëŒ€ 10ê°œ ì—ì´ì „íŠ¸
ì´ìœ : 
- ë©”ëª¨ë¦¬ 1GB Ã· 10ê°œ = ì—ì´ì „íŠ¸ë‹¹ ~100MB
- ë³µì¡ë„ ê´€ë¦¬ ê°€ëŠ¥
- UIì—ì„œ í‘œì‹œí•˜ê¸° ì ì ˆí•œ ìˆ˜ëŸ‰
```

### ë™ì‹œ ì‹¤í–‰ ì—ì´ì „íŠ¸ ì œí•œ
```
ê¶Œì¥: ì‚¬ìš©ìë‹¹ ìµœëŒ€ 3ê°œ ë™ì‹œ ì‹¤í–‰
ì´ìœ :
- CPU 1ì½”ì–´ Ã· 3ê°œ = ì ì ˆí•œ ì„±ëŠ¥ ë³´ì¥
- Claude API ë ˆì´íŠ¸ ë¦¬ë°‹ ê³ ë ¤
- ì‚¬ìš©ì ê²½í—˜ í’ˆì§ˆ ìœ ì§€
```

---

## ğŸ¯ ê²°ë¡  ë° ì‹¤í–‰ ê³„íš

### âœ… ê²°ë¡ : í˜„ì¬ ì•„í‚¤í…ì²˜ ìœ ì§€

**"1ì¸ 1ì»¨í…Œì´ë„ˆ"** ë°©ì‹ì€ ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±:
- âœ… ì ì€ ì½”ë“œ
- âœ… ë‹¨ìˆœí•œ êµ¬ì¡°  
- âœ… ì¶©ë¶„í•œ ì„±ëŠ¥
- âœ… ê´€ë¦¬ ìš©ì´ì„±

### ğŸ“ ìµœì†Œí•œì˜ ê°œì„ ì‚¬í•­

1. **ì—ì´ì „íŠ¸ë³„ ì‘ì—… ë””ë ‰í† ë¦¬ ë¶„ë¦¬** (3ì¤„ ì½”ë“œ ì¶”ê°€)
2. **ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§** (5ì¤„ ì½”ë“œ ì¶”ê°€)
3. **ì—ì´ì „íŠ¸ ìˆ˜ ì œí•œ ì²´í¬** (2ì¤„ ì½”ë“œ ì¶”ê°€)

### ğŸš€ êµ¬í˜„ ìš°ì„ ìˆœìœ„

1. **Phase 1**: í˜„ì¬ êµ¬ì¡° ê·¸ëŒ€ë¡œ ëŒ€ì‹œë³´ë“œ UI ì™„ì„±
2. **Phase 2**: ì—ì´ì „íŠ¸ë³„ ë””ë ‰í† ë¦¬ ë¶„ë¦¬ë§Œ ì¶”ê°€
3. **Phase 3**: ê¸°ë³¸ ì œí•œ ë° ëª¨ë‹ˆí„°ë§ ì¶”ê°€

---

## ğŸ’» ì½”ë“œ ë³€ê²½ ìµœì†Œí™” ì˜ˆì‹œ

```python
# ê¸°ì¡´ ì½”ë“œì— 3ì¤„ë§Œ ì¶”ê°€
async def send_to_claude(self, message: str, agent_id: str = None) -> str:
    container = await self.ensure_container()
    
    # ì—ì´ì „íŠ¸ë³„ ì‘ì—… ë””ë ‰í† ë¦¬ (ì‹ ê·œ ì¶”ê°€)
    workdir = f"/workspace/agent-{agent_id}" if agent_id else "/workspace"
    Path(workdir).mkdir(exist_ok=True)  # ë””ë ‰í† ë¦¬ ìƒì„±
    
    result = container.exec_run(
        cmd=f"claude --print --dangerously-skip-permissions '{escaped_message}'",
        user='claude',
        workdir=workdir  # ê¸°ì¡´: '/workspace' â†’ ë³€ê²½: workdir
    )
```

ì´ ì •ë„ì˜ **ìµœì†Œí•œì˜ ë³€ê²½**ìœ¼ë¡œë„ ì—ì´ì „íŠ¸ ê°„ íŒŒì¼ ì¶©ëŒì„ ë°©ì§€í•˜ë©´ì„œ êµ¬ì¡°ì˜ ë‹¨ìˆœì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

**í•µì‹¬ ë©”ì‹œì§€**: í˜„ì¬ ì•„í‚¤í…ì²˜ëŠ” ìš”êµ¬ì‚¬í•­ì— ìµœì í™”ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, **ê³¼ë„í•œ ìµœì í™”ë³´ë‹¤ëŠ” ë‹¨ìˆœì„± ìœ ì§€**ì— ì§‘ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤.