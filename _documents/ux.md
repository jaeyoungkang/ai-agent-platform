### **1. 에이전트 생성 경험 구체화 (UI/UX)**

기존의 단순한 채팅창 개념을 넘어, 사용자가 LLM과 협업하여 에이전트를 점진적으로 완성해나가는 동적인 대화형 경험(Conversational Experience)을 제공하는 것으로 구체화합니다.

* **점진적 빌드업:** 사용자는 "A 주식 정보를 수집하는 에이전트를 만들고 싶어" 와 같이 포괄적인 목표를 제시하는 것으로 시작합니다. 이후 LLM과의 대화를 통해 스케줄 설정, 작업 단계 정의 등 세부 사항을 하나씩 구체화합니다.
* **단순 텍스트를 넘어서는 인터랙션:** LLM의 답변은 단순한 텍스트 응답에 그치지 않고, 다음과 같은 동적인 요소를 포함하여 사용자에게 풍부한 피드백을 제공합니다.
    * **상태 표시:** "분석 중...", "테스트 실행 중..." 과 같이 현재 시스템이 무엇을 하고 있는지 명확히 보여줍니다.
    * **중간 결과 제시:** "테스트 결과 100개의 뉴스가 검색되었습니다." 와 같이 각 단계의 실행 결과를 요약하여 보여주고, 사용자의 확인을 거쳐 다음 단계로 진행합니다.
    * **UI 컴포넌트 연동:** "\[스케줄 UI 표시\]", "\[결과 문서 표시\]" 와 같이 대화 내용과 관련된 시각적인 UI 요소를 채팅창 내에 직접 표시하여 직관적인 상호작용을 돕습니다.

---

### **2. 기술 사양 및 데이터 구조**

상기된 대화형 경험을 완벽하게 지원하고, 서비스의 확장성과 성능을 확보하기 위해 Firestore 데이터 구조를 다음과 같이 최종 확정합니다.

* **'코드' 대신 '자연어 프롬프트' 저장:** 에이전트의 최종 결과물은 실행 가능한 Python 코드가 아닌, Claude Code Agent Runner가 해석할 수 있는 정제된 **자연어 지시문(`finalAgentPrompt`)**입니다.
* **대화 기록의 분리 저장 (하위 컬렉션):** 에이전트의 기본 정보(`agents` 컬렉션)와 생성 과정의 대화 기록(`conversation` 하위 컬렉션)을 분리하여 관리 효율성과 성능을 높입니다.
* **구조화된 메시지 포맷:** 동적인 인터랙션을 지원하기 위해, 대화 메시지를 단순 텍스트가 아닌 구조화된 데이터(`parts` 배열)로 저장합니다.
* **상세 실행 로그 기록:** `logs` 컬렉션에는 최종 성공/실패 여부뿐만 아니라, 에이전트가 어떤 작업을 순서대로 수행했는지 상세한 내역(`executionSteps`)을 단계별로 모두 기록합니다.

---

### **3. 상세 예시 대화: '주간 주식 뉴스 분석 에이전트' 생성 과정**

**사용자:**
> 안녕하세요. 매주 특정 주식에 대한 최신 정보를 수집하고 분석하는 에이전트를 만들고 싶어요.

**AI 어시스턴트:**
> 네, 좋습니다! '주간 주식 분석 에이전트' 생성을 시작하겠습니다. 먼저, 이 에이전트가 언제 실행되기를 원하시나요? 스케줄을 설정해주세요.

**사용자:**
> 매주 월요일 오전 8시에 자동으로 실행되었으면 합니다.

**AI 어시스턴트:**
> `[상태 표시: 스케줄 설정 중...]`
> 알겠습니다. 스케줄이 다음과 같이 설정되었습니다.
> `[UI 컴포넌트: 스케줄 정보]`
> **실행 주기:** 매주
> **실행 요일:** 월요일
> **실행 시간:** 오전 8:00
> 이제 에이전트가 수행할 첫 번째 작업을 알려주세요.

**사용자:**
> 첫 번째 작업은, 지난 1주일 동안 '알파벳(Alphabet)' 사와 관련된 주요 뉴스들을 중복 없이, 관련도 순으로 수집하는 것입니다.

**AI 어시스턴트:**
> `[상태 표시: 작업 분석 중...]`
> 네, 첫 번째 작업으로 '알파벳(Alphabet) 주간 뉴스 수집'을 설정하겠습니다. 이 작업을 위해 `Google News API`를 사용하는 것이 가장 효율적일 것 같습니다. 설정이 잘 되었는지 확인하기 위해, 지난 1주일간의 데이터를 바탕으로 테스트를 한번 실행해 보겠습니다.
> `[상태 표시: 테스트 실행 중...]`
> `[UI 컴포넌트: 테스트 결과 요약]`
> **테스트 요약:** 총 152개의 관련 뉴스를 발견했으며, 중복 및 광고성 기사를 제외하고 118개의 유효한 뉴스를 수집했습니다.
> **샘플 데이터:**
> 1. "Alphabet, AI 신규 모델 발표로 주가 상승" (Reuters)
> 2. "Waymo, 자율주행 서비스 지역 확대" (TechCrunch)
> 3. ...
> `[UI 컴포넌트: 토큰 사용량 정보]`
> **토큰 사용량:** 입력 1,234 토큰, 출력 2,567 토큰
> `[상세 결과 보기 버튼]`
> 이 결과가 만족스러우신가요? 다음 단계를 진행할까요?

**사용자:**
> 네, 아주 좋습니다. 그럼 다음 단계로, 수집된 118개의 뉴스 기사 본문을 3개의 핵심 문장으로 각각 요약해주세요.

**AI 어시스턴트:**
> `[상태 표시: 작업 분석 중...]`
> 알겠습니다. 두 번째 작업으로 '수집된 뉴스 3줄 요약'을 추가합니다. 요약 작업에는 최신 자연어 처리 모델을 사용하겠습니다.
> 이제 모든 단계가 설정되었습니다. 생성된 에이전트의 최종 작업 흐름은 다음과 같습니다.
> `[UI 컴포넌트: 에이전트 최종 정보]`
> **에이전트 이름:** 주간 주식 분석 에이전트
> **실행 스케줄:** 매주 월요일 오전 8:00
> **작업 흐름:**
> 1. **(뉴스 수집)** 지난 1주일간 '알파벳' 관련 뉴스를 관련도 순으로 수집
> 2. **(뉴스 요약)** 수집된 각 뉴스를 3개의 핵심 문장으로 요약
> `[UI 컴포넌트: 예상 토큰 사용량]`
> **예상 월간 사용량:** 입력 ~15,000 토큰, 출력 ~25,000 토큰
> 이대로 에이전트 생성을 완료할까요?

**사용자:**
> 완벽합니다. 생성해주세요.

**AI 어시스턴트:**
> `[상태 표시: 에이전트 생성 중...]`
> '주간 주식 분석 에이전트' 생성이 완료되었습니다! 이제 대시보드에서 에이전트의 상태를 확인하고 관리할 수 있습니다.
> `[UI 컴포넌트: 에이전트 카드 - 토큰 사용량 표시]`
> **생성 완료 - 주간 주식 분석 에이전트**
> • 현재 상태: 활성화됨
> • 누적 토큰 사용량: 입력 3,801 토큰, 출력 6,134 토큰
> • 다음 실행 예정: 2024년 1월 8일 월요일 오전 8:00